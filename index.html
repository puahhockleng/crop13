<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Photo Uploading and Cropping Tool</title>

    <!-- Latest compiled and minified Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Popper JS 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    -->
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script> 
    <style>
        canvas {
            width: 80%;
            height: auto;
        }
        
        #gettingstarted {
            width: 100%;
            height: auto;
        }
        @media only screen and (min-width: 500px) { 
            canvas {
                width: 400px;
                height: auto;
            }

            #gettingstarted {
                width: 500px;
                height: auto;
            }
        }


        #myCanvasTop { position: absolute; z-index: 2}
        #myCanvas    { position: absolute; z-index: 1}

        .fixed-bottom {
            position: fixed;
            margin: auto;
            height: 100px;
            width: 100%;
            right: 0;
            bottom: 0;
            left: 0;
            z-index: 1030;
        }
    </style>
</head>

<body>

<div class="container-fluid">
    <p id="hints" class="mb-1 lead">ERROR: Your browser does not support this application.  Please try it with another browser.</p>
    <div class="input-group my-0">
        <input id="fileTocrop" type="file" class="form-control"  aria-describedby="basic-addon2">
    </div>

    <div class="input-group mb-1" id="fileInput">
        <input id="fileTosave" type="text" class="form-control" placeholder="NRIC no. Eg T1111111Z" aria-label="NRIC no. Eg T1111111Z" aria-describedby="basic-addon2">
        <div class="input-group-append">
          <span id="labelTosave" class="input-group-text" id="basic-addon2">.jpg</span>
        </div>
    </div>

    <div class="alert alert-primary" role="alert" id="alert1">
        This application works best on <u>Safari for iPhones/iPads</u> and <u>Chrome for Android phones / Desktop computers / Laptops</u>.
        <div>
            <img id='gettingstarted' src='https://puahhockleng.github.io/photocrop/gettingstarted.gif' alt='demo' >
        </div>
    </div>

    <div class="alert alert-danger" role="alert" id="alert2">
        <p>The guidelines of the digital photo for submission:</p>
            <ul>
                <li>must be in colour, taken against <strong>plain white background without shadow</strong></li>
                <li>must be taken within the last 3 months</li>
                <li>show the full face <strong>without headgear</strong> [<strong>eyes, eyebrows & ears</strong> must be visible]</li>
                <li>show that your hair is neatly combed or tied up and must be of <strong>natural colour</strong></li>
                <li>not showing any outrageous earrings</li>
            </ul>
    </div>

    <div class="row" id="allCanvas">
        <div id="col2">
            <canvas  id="myCanvasTop"></canvas>
            <canvas  id="myCanvas"></canvas>
        </div>
        <div id="col3">
            <canvas  id="myCropcanvas"></canvas>
        </div>
        <div id="col4">
            <canvas  id="myTempcanvas"></canvas>
        </div>
    </div>

    <div class="fixed-bottom">
        <button class="btn btn-primary btn-lg" id="btnRotate" disabled>Rotate photo</button>
        <button class="btn btn-primary btn-lg" id="btnFlip" disabled>Flip selfie</button>
        <button class="btn btn-primary btn-lg" id="btnClearrect" disabled>Clear rectangle</button>
        <button class="btn btn-primary btn-lg" id="btnCrop" disabled>Crop photo</button>
        <button class="btn btn-primary btn-lg" id="btnSave" disabled>Save photo</button>
    </div>
</div>
<!--Copyright (C) 2018 Puah Hock Leng - All Rights Reserved
    Puah_Hock_Leng&#64;ite&#46;edu&#46;sg  -->
    <script>$(document).ready(function(){var t=$("#hints"),e=$("#alert1"),a=$("#alert2"),o=$("#fileTocrop"),i=$("#fileTosave"),s=$("#labelTosave"),r=$("#btnRotate"),n=$("#btnFlip"),l=$("#btnClearrect"),d=$("#btnCrop"),h=$("#btnSave"),c=$("#myCanvas"),p=c[0],g=p.getContext("2d"),m=$("#myCanvasTop"),u=m[0],v=u.getContext("2d");v.globalAlpha=.2;var b,f=$("#myCropcanvas"),w=f[0],y=w.getContext("2d"),C=$("#myTempcanvas")[0],M=C.getContext("2d"),k=$("#col2"),x=$("#col3"),R=$("#col4"),I=!1,T=!1,A=5,D=!1,L=/ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()),P=/msie|trident|edge/i.test(navigator.userAgent.toLowerCase()),j=/crios/i.test(navigator.userAgent.toLowerCase()),U=/webkit/i.test(navigator.userAgent.toLowerCase()),S=["Rotate/Flip photo if necessary.  Tap, hold and drag on image to draw a rectangle crop area  . . .","Tap, hold and drag on the photo to draw a rectangle area to crop it to size . . . . . . . . . . .","Click on ‘Clear rectangle’ to start again.  Click ‘Crop photo’ if you are satisfied with it . . .","Type in the filename to save as and click ‘Save photo’.","Select a photo from your device to crop.","Only Safari browser is supported on iPhones/iPads.  Your browser is not supported!","Only Chrome browser is supported on Desktop computers/Laptops.  Your browser is not supported!"];L&&U&&j?t.html("<div class='alert alert-danger' role='alert'>"+S[5]+"</div>"):P?t.html("<div class='alert alert-danger' role='alert'>"+S[6]+"</div>"):t.text(S[4]);var Y,O;Y=p.getBoundingClientRect(),O=window.devicePixelRatio,p.width=Math.round(O*Y.right)-Math.round(O*Y.left),p.height=Math.round(O*Y.bottom)-Math.round(O*Y.top),g.scale(O,O),i.hide(),s.hide(),c.hide(),r.hide(),n.hide(),l.hide(),d.hide(),h.hide();var E,F,z=new Image;o.on("change",function(i){t.text(S[0]),e.hide(),a.hide();var s=new FileReader;s.onload=function(t){z.onload=function(){E=z.width,F=z.height,E>F?E>480&&(F*=480/E,E=480):F>360&&(E*=360/F,F=360),u.width=p.width=E,u.height=p.height=F,g.drawImage(z,0,0,E,F),A=Math.round(5/480*E)},z.src=t.target.result},s.readAsDataURL(i.target.files[0]),c.fadeIn(),k.addClass("col-12"),r.removeAttr("disabled").fadeIn(),n.removeAttr("disabled").fadeIn(),o.hide(),I=!0,T=!0});var B=1,W=!1;r.on("click",function(e){t.text(S[0]),W=!0,Z(),B++,W=!1,I=!0});var X=1,J=!1;n.on("click",function(e){t.text(S[0]),J=!0,Z(),X++,J=!1,I=!0});var Z=function(){g.clearRect(0,0,p.width,p.height);var t=W?B:B-1;t%2==0?(u.width=p.width=E,u.height=p.height=F):(u.width=p.width=F,u.height=p.height=E),g.save(),t%2==0?g.translate(E/2,F/2):g.translate(F/2,E/2),g.rotate(90*t*Math.PI/180),g.translate(-E/2,-F/2),(J?X:X-1)%2==0||(t%2==0?(g.translate(E,0),g.scale(-1,1)):(g.translate(0,F),g.scale(1,-1))),g.drawImage(z,0,0,E,F),g.restore()},q="";$(window).on("scroll",function(e){q=t.html(),!D&&T&&l.trigger("click"),t.html(q)}),$(window).on("resize",function(e){q=t.html(),!D&&T&&l.trigger("click"),t.html(q)}),l.on("click",function(e){t.text(S[1]),lt(),v.clearRect(0,0,p.width,p.height),I=!0,d.hide()}),d.on("click",function(){if(t.text(S[3]),l.hide(),d.hide(),h.removeAttr("disabled").fadeIn(),tt>at){var e=tt;tt=at,at=e}if(et>ot){e=et;et=ot,ot=e}b=g.getImageData(tt,et,at-tt,ot-et),C.width=at-tt,C.height=ot-et,M.putImageData(b,0,0),w.width=240,w.height=320;var a=new Image;a.onload=function(){y.drawImage(a,0,0,240,320)},a.src=C.toDataURL(),k.remove(),x.addClass("col-6"),R.remove(),i.show(),s.show(),D=!0});var G=$("#fileInput"),H=$("#allCanvas");h.on("click",function(){if(L||P)if(P){var e="<!DOCTYPE html><html lang='en'><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'><title>Photo Uploading and Cropping Tool</title><link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css'><script src='https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js'><\/script></head><body><div class='container-fluid'><p class='mb-1'><div class='alert alert-primary' role='alert'>Right click on the image, select 'Save picture as' to save.</p></div> <div class='text-center'><img src='"+f[0].toDataURL("image/jpeg",1)+"' alt='from canvas'/></div><p class='mb-1'><div class='alert alert-success' role='alert'>Then login via <a href='https://myportal.ite.edu.sg/regsubmission/'>myportal.ite.edu.sg/regsubmission</a> to submit the saved photo.</div></p></div></body></html>";(a=window.open()).document.write(e),a?a.focus():alert("Please allow popups for this website")}else{var a;e="<!DOCTYPE html><html lang='en'><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'><title>Photo Uploading and Cropping Tool</title><link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css'><script src='https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js'><\/script></head><body><div class='container-fluid'><div class='text-center'><img src='"+f[0].toDataURL("image/jpeg",1)+"' alt='from canvas'/></div><p class='mb-1'><div class='alert alert-danger' role='alert'>Tap and hold on the image, tap the Save Image button to save. [Watch Demo]</div></p><p class='mb-1'><div class='alert alert-success' role='alert'>Then login via <a href='https://myportal.ite.edu.sg/regsubmission/'>myportal.ite.edu.sg/regsubmission</a> to submit the saved photo.</div></p><img style ='width:100%; height:auto;' src='https://puahhockleng.github.io/photocrop/MyMovie2.gif' alt='demo' ></div></body></html>";(a=window.open()).document.write(e),a?a.focus():alert("Please allow popups for this website")}else{var o=document.createElement("a");o.style="position: fixed; left -10000px;",o.href="data:application/octet-stream;base64,"+encodeURIComponent(f[0].toDataURL("image/jpeg").replace(/^data:image\/\w+;base64,/,"")),o.download=""==i.val()?"T1111111Z.jpg":i.val()+".jpg",document.body.appendChild(o),o.click(),document.body.removeChild(o),t.html("<div class='alert alert-primary' role='alert'>Login via <a href='https://myportal.ite.edu.sg/regsubmission/'>myportal.ite.edu.sg/regsubmission</a> to submit the saved photo.</div>"),h.hide(),G.hide(),H.hide()}}),m.on("mousedown touchstart",function(t){T&&!D&&(I||l.trigger("click"),it=!0,st(t),rt(K,N,!1))}),m.on("mousemove touchmove",function(t){it&&!D&&(st(t),rt(K,N,!0),nt())}),m.on("mouseup touchend",function(){it&&!D&&(t.text(S[2]),nt(),lt(),I=!1)}),m.on("mouseleave touchcancel",function(){it&&!D&&(t.text(S[2]),nt(),lt(),I=!1)});var K=0,N=0,Q=new Array,V=new Array,_=new Array,tt=0,et=0,at=0,ot=0,it=!1,st=function(t){var e=p.getBoundingClientRect(),a=p.width/e.width,o=p.height/e.height;t.touches?(K=(t.touches[0].pageX-e.left)*a,N=(t.touches[0].pageY-e.top)*o,t.preventDefault()):(K=(t.clientX-e.left)*a,N=(t.clientY-e.top)*o)},rt=function(t,e,a){Q.push(t),V.push(e),_.push(a)},nt=function(){v.strokeStyle="#df4b26",v.lineJoin="round",v.lineWidth=A,Q.length>0&&(v.clearRect(0,0,p.width,p.height),tt=Q[0],et=V[0],at=Q[Q.length-1],ot=V[V.length-1],tt<at&&et<ot?(Math.abs(at-tt)/Math.abs(ot-et)<.75?ot=320/240*(at-tt)+et:at=.75*(ot-et)+tt,v.strokeRect(tt,et,Math.abs(at-tt),Math.abs(ot-et))):tt>at&&et<ot?(Math.abs(at-tt)/Math.abs(ot-et)<.75?ot=320/240*(tt-at)+et:at=tt-.75*(ot-et),v.strokeRect(at,et,Math.abs(at-tt),Math.abs(ot-et))):tt<at&&et>ot?(Math.abs(at-tt)/Math.abs(ot-et)<.75?ot=320/240*(at-tt)+et:at=.75*(et-ot)+tt,v.strokeRect(tt,ot,Math.abs(at-tt),Math.abs(ot-et))):(Math.abs(at-tt)/Math.abs(ot-et)<.75?ot=320/240*(tt-at)+et:at=tt-.75*(et-ot),v.strokeRect(at,ot,Math.abs(at-tt),Math.abs(ot-et))),l.removeAttr("disabled").fadeIn(),d.removeAttr("disabled").fadeIn(),r.hide(),n.hide())},lt=function(){Q.length=0,V.length=0,_.length=0,it=!1}});</script>
    </body>
</html>